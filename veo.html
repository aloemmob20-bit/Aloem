<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Veo2 Video Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-6">
  <div class="w-full max-w-lg bg-gray-800 rounded-2xl shadow-xl p-6 space-y-4">
    <h1 class="text-2xl font-bold text-center">Follow TikTok : aloemTV</h1>

    <!-- Input API Key -->
    <div>
      <label class="block mb-1">API Key Google</label>
      <input id="apiKey" type="text" placeholder="Masukkan API Key"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
    </div>

    <!-- Input Prompt -->
    <div>
      <label class="block mb-1">Prompt (Deskripsi Video)</label>
      <textarea id="prompt" rows="3" placeholder="Contoh: Pemandangan pantai indah dengan langit senja"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600"></textarea>
    </div>

    <!-- Tombol Generate -->
    <button onclick="generateVideo()" 
      class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-semibold">
      üöÄ Generate Video
    </button>

    <!-- Status -->
    <p id="status" class="text-sm text-gray-400 text-center"></p>

    <!-- Preview Video -->
    <div id="previewBox" class="hidden">
      <h2 class="text-lg font-bold mt-4 mb-2">Preview Video</h2>
      <video id="preview" class="w-full rounded-lg shadow-md" controls></video>
      <button id="downloadBtn" 
        class="mt-4 w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-semibold">
        ‚¨áÔ∏è Download MP4
      </button>
    </div>
  </div>

  <script>
    async function generateVideo() {
      const apiKey = document.getElementById("apiKey").value.trim();
      const prompt = document.getElementById("prompt").value.trim();
      const status = document.getElementById("status");
      const previewBox = document.getElementById("previewBox");
      const videoEl = document.getElementById("preview");
      const downloadBtn = document.getElementById("downloadBtn");

      if (!apiKey || !prompt) {
        alert("Isi API Key dan Prompt dulu!");
        return;
      }

      status.textContent = "‚è≥ Mengirim permintaan ke Veo2...";
      previewBox.classList.add("hidden");

      // 1. Request Video
      const res = await fetch(
        "https://generativelanguage.googleapis.com/v1beta/models/veo-2.0:generateVideo?key=" + apiKey,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt: { text: prompt },
            aspectRatio: "9:16"
          })
        }
      );

      const operation = await res.json();
      if (operation.error) {
        status.textContent = "‚ùå Error: " + operation.error.message;
        return;
      }

      status.textContent = "‚è≥ Video sedang diproses... tunggu beberapa detik";

      // 2. Polling (cek sampai selesai)
      let opResult;
      while (true) {
        const check = await fetch("https://generativelanguage.googleapis.com/v1beta/" + operation.name + "?key=" + apiKey);
        opResult = await check.json();
        if (opResult.done) break;
        await new Promise(r => setTimeout(r, 5000)); // cek tiap 5 detik
      }

      // 3. Ambil URI video
      const fileUrl = opResult.response.generatedVideos[0].video.uri;

      // 4. Tampilkan preview
      videoEl.src = fileUrl;
      previewBox.classList.remove("hidden");
      status.textContent = "‚úÖ Video siap diputar & didownload";

      // 5. Tombol Download
      downloadBtn.onclick = async () => {
        const fileRes = await fetch(fileUrl);
        const blob = await fileRes.blob();
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "video.mp4";
        a.click();
        URL.revokeObjectURL(url);
      };
    }
  </script>
</body>
</html>
