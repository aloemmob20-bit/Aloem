<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Veo2 Video Generator + 2 Gambar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-6">
  <div class="w-full max-w-lg bg-gray-800 rounded-2xl shadow-xl p-6 space-y-4">
    <h1 class="text-2xl font-bold text-center">ğŸ¬ Veo2 Video Generator</h1>

    <!-- Input API Key -->
    <div>
      <label class="block mb-1">API Key Google</label>
      <input id="apiKey" type="text" placeholder="Masukkan API Key"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
    </div>

    <!-- Input Prompt -->
    <div>
      <label class="block mb-1">Prompt (Deskripsi Video)</label>
      <textarea id="prompt" rows="3" placeholder="Contoh: Dua orang berjalan di kota cyberpunk"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600"></textarea>
    </div>

    <!-- Upload Gambar 1 -->
    <div>
      <label class="block mb-1">Tambahkan Gambar 1 (Opsional)</label>
      <input id="imageInput1" type="file" accept="image/*"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
    </div>

    <!-- Upload Gambar 2 -->
    <div>
      <label class="block mb-1">Tambahkan Gambar 2 (Opsional)</label>
      <input id="imageInput2" type="file" accept="image/*"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
    </div>

    <!-- Opsi Orientasi -->
    <div>
      <label class="block mb-1">Orientasi Video</label>
      <select id="orientation" class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
        <option value="9:16">ğŸ“± Potret (9:16)</option>
        <option value="16:9">ğŸ–¥ï¸ Landscape (16:9)</option>
      </select>
    </div>

    <!-- Opsi Durasi -->
    <div>
      <label class="block mb-1">Durasi</label>
      <select id="duration" class="w-full px-3 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
        <option value="5">5 Detik</option>
        <option value="8">8 Detik</option>
      </select>
    </div>

    <!-- Adult Content -->
    <div class="flex items-center space-x-2">
      <input id="adult" type="checkbox" class="w-4 h-4">
      <label for="adult">Izinkan konten dewasa ğŸ”</label>
    </div>

    <!-- Tombol Generate -->
    <button onclick="generateVideo()" 
      class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-semibold">
      ğŸš€ Generate Video
    </button>

    <!-- Status -->
    <p id="status" class="text-sm text-gray-400 text-center"></p>

    <!-- Preview Video -->
    <div id="previewBox" class="hidden">
      <h2 class="text-lg font-bold mt-4 mb-2">Preview Video</h2>
      <video id="preview" class="w-full rounded-lg shadow-md" controls></video>
      <button id="downloadBtn" 
        class="mt-4 w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-semibold">
        â¬‡ï¸ Download MP4
      </button>
    </div>
  </div>

  <script>
    async function uploadImage(apiKey, file) {
      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch(
        "https://generativelanguage.googleapis.com/upload/v1beta/files?key=" + apiKey,
        { method: "POST", body: formData }
      );

      const data = await res.json();
      if (data.error) throw new Error(data.error.message);
      return data.file.uri; // Link gambar
    }

    async function generateVideo() {
      const apiKey = document.getElementById("apiKey").value.trim();
      const prompt = document.getElementById("prompt").value.trim();
      const orientation = document.getElementById("orientation").value;
      const duration = parseInt(document.getElementById("duration").value);
      const adult = document.getElementById("adult").checked;
      const status = document.getElementById("status");
      const previewBox = document.getElementById("previewBox");
      const videoEl = document.getElementById("preview");
      const downloadBtn = document.getElementById("downloadBtn");
      const imageInput1 = document.getElementById("imageInput1");
      const imageInput2 = document.getElementById("imageInput2");

      if (!apiKey || !prompt) {
        alert("Isi API Key dan Prompt dulu!");
        return;
      }

      status.textContent = "â³ Mengupload gambar (jika ada)...";
      previewBox.classList.add("hidden");

      let imageUris = [];
      try {
        if (imageInput1.files.length > 0) {
          imageUris.push(await uploadImage(apiKey, imageInput1.files[0]));
        }
        if (imageInput2.files.length > 0) {
          imageUris.push(await uploadImage(apiKey, imageInput2.files[0]));
        }
      } catch (err) {
        status.textContent = "âš ï¸ Gagal upload gambar: " + err.message;
        return;
      }

      status.textContent = "â³ Mengirim permintaan ke Veo2...";

      // Request Video
      const res = await fetch(
        "https://generativelanguage.googleapis.com/v1beta/models/veo-2.0:generateVideo?key=" + apiKey,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt: { 
              text: prompt,
              images: imageUris.map(uri => ({ uri }))
            },
            aspectRatio: orientation,
            durationSeconds: duration,
            safetySettings: adult ? [] : [{ category: "ADULT", threshold: "BLOCK_ONLY_HIGH" }]
          })
        }
      );

      const operation = await res.json();
      if (operation.error) {
        status.textContent = "âŒ Error: " + operation.error.message;
        return;
      }

      status.textContent = "â³ Video sedang diproses... tunggu beberapa detik";

      // Polling sampai selesai
      let opResult;
      while (true) {
        const check = await fetch("https://generativelanguage.googleapis.com/v1beta/" + operation.name + "?key=" + apiKey);
        opResult = await check.json();
        if (opResult.done) break;
        await new Promise(r => setTimeout(r, 5000));
      }

      // Ambil URI video
      const fileUrl = opResult.response.generatedVideos[0].video.uri;

      // Preview
      videoEl.src = fileUrl;
      previewBox.classList.remove("hidden");
      status.textContent = "âœ… Video siap diputar & didownload";

      // Download
      downloadBtn.onclick = async () => {
        const fileRes = await fetch(fileUrl);
        const blob = await fileRes.blob();
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "video.mp4";
        a.click();
        URL.revokeObjectURL(url);
      };
    }
  </script>
</body>
</html>
