<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Veo2 Image-to-Video Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea, input { width: 100%; margin: 10px 0; }
    video { max-width: 100%; margin-top: 20px; display: none; }
    #status { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>🎬 Generate Video dengan Veo2 (9:16)</h2>

  <input type="file" id="imageInput" accept="image/*"><br>
  <textarea id="prompt" rows="4" placeholder="Tulis deskripsi video..."></textarea><br>
  <button onclick="generateVideo()">🚀 Generate Video</button>

  <p id="status"></p>
  <video id="resultVideo" controls></video>

  <script>
    // Ganti API key di sini ⚠️ (tidak aman kalau dipakai di hosting publik)
    const API_KEY = "AIzaSyAm8ng_6fYaW2qo7sIJIIQP_vXi8qH_rsA";
    const ENDPOINT = "https://generativelanguage.googleapis.com/v1beta/models/veo-2.0-generate-001:generateVideo?key=" + API_KEY;

    async function generateVideo() {
      const prompt = document.getElementById("prompt").value;
      const file = document.getElementById("imageInput").files[0];
      if (!file) { alert("Pilih gambar dulu!"); return; }

      document.getElementById("status").innerText = "⏳ Upload & proses...";

      const base64Image = await toBase64(file);

      const requestBody = {
        instances: [{
          prompt: prompt,
          image: {
            bytesBase64Encoded: base64Image.split(",")[1],
            mimeType: file.type
          }
        }],
        parameters: {
          aspectRatio: "9:16",
          durationSeconds: 6
        }
      };

      try {
        const response = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(requestBody)
        });

        const result = await response.json();
        console.log(result);

        if (result.error) {
          document.getElementById("status").innerText = "❌ ERROR: " + result.error.message;
          return;
        }

        // Biasanya API balikin job ID, bukan langsung video → harus polling
        if (result.video && result.video.uri) {
          showVideo(result.video.uri);
        } else {
          document.getElementById("status").innerText = "✅ Job dikirim. Cek console untuk detail job (harus polling).";
        }

      } catch (err) {
        document.getElementById("status").innerText = "❌ Request gagal: " + err;
      }
    }

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }

    function showVideo(url) {
      document.getElementById("status").innerText = "✅ Video siap!";
      const videoEl = document.getElementById("resultVideo");
      videoEl.src = url;
      videoEl.style.display = "block";
    }
  </script>
</body>
</html>
